{% extends "layout.html" %}

{% block pageTitle %}
  Check your answers
{% endblock %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      {{ govukBackLink({
        text: "Back",
        href: "/"
      }) }}
      <h1 class="govuk-heading-l govuk-!-padding-top-6">
        {{ data['product-name'] }}
      </h1>
    </div>
  </div>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h2 class="govuk-heading-m govuk-!-padding-top-6">
        Case
      </h2>

      <dl class="app-check-your-answers app-check-your-answers--short">
        <div class="app-check-your-answers__contents">
          <dt class="app-check-your-answers__question">
            Case number
          </dt>
          <dd class="app-check-your-answers__answer">
            {% if data['do-you-have-case-number'] === 'yes' %}
              {{ data['case-number']}}
            {% else %}
              <span class="hint-text">Optional</span>
            {% endif %}
          </dd>
          <dd class="app-check-your-answers__change">
            <a href="case-number">
              {% if data['do-you-have-case-number'] === 'yes' %}
                Change<span class="govuk-visually-hidden"> Case number</span>
              {% else %}
                Add<span class="govuk-visually-hidden"> Case number</span>
              {% endif %}
            </a>
          </dd>
        </div>
        <div class="app-check-your-answers__contents">
          <dt class="app-check-your-answers__question">
            Uploaded file
          </dt>
          <dd class="app-check-your-answers__answer">
            {% if data['do-you-have-a-report'] === 'yes' %}
              {{ data['upload-report']}}
            {% else %}
              No file uploaded
            {% endif %}
          </dd>
          <dd class="app-check-your-answers__change">
            <a href="do-you-have-a-report">
              Change<span class="govuk-visually-hidden"> file</span>
            </a>
          </dd>
        </div>
        <div class="app-check-your-answers__contents">
          <dt class="app-check-your-answers__question">
            CACS case number
          </dt>
          <dd class="app-check-your-answers__answer">
            {% if data['cacs-case-number'] %}
              {{ data['cacs-case-number']}}
            {% else %}
              <span class="hint-text">Optional</span>
            {% endif %}
          </dd>
          <dd class="app-check-your-answers__change">
            <a href="cacs-case-number">
              {% if data['cacs-case-number'] %}
                Change<span class="govuk-visually-hidden"> CACS case number</span>
              {% else %}
                Add<span class="govuk-visually-hidden"> CACS case number</span>
              {% endif %}
            </a>
          </dd>
        </div>
      </dl>

      <h2 class="govuk-heading-m govuk-!-padding-top-6">
        Incident
      </h2>

      <dl class="app-check-your-answers app-check-your-answers--short">
        <div class="app-check-your-answers__contents">
          <dt class="app-check-your-answers__question">
            Incident severity
          </dt>
          <dd class="app-check-your-answers__answer">
            {{ data['how-severe-is-your-case']}}
          </dd>
          <dd class="app-check-your-answers__change">
            <a href="incident-severity">
              Change<span class="govuk-visually-hidden"> severity</span>
            </a>
          </dd>
        </div>
      </dl>

      {{ required_field("Description", "description-of-incident", "Required if no case file attached") }}

      <h2 class="govuk-heading-m govuk-!-padding-top-6">
        Product
      </h2>

      {{ required_field("Name", "product-name", "Required if no case file attached") }}

      <dl class="app-check-your-answers app-check-your-answers--short">
        <div class="app-check-your-answers__contents">
          <dt class="app-check-your-answers__question">
            Category
          </dt>
          <dd class="app-check-your-answers__answer">
            {% if data | anyCategories %}
              <ul class="govuk-list govuk-list--bullet">
                {% for category in data | getCategories %}
                  <li>{{ category }}</li>
                {% endfor %}
              </ul>
            {% elif data['do-you-have-a-report'] === 'yes' %}
              <span class="hint-text">Optional</span>
            {% else %}
              <span class="hint-text">Required if no case file attached</span>
            {% endif %}
          </dd>
          <dd class="app-check-your-answers__change">
            <a href="product-categories">
              {% if data | anyCategories %}
                Change<span class="govuk-visually-hidden"> categories</span>
              {% else %}
                Add<span class="govuk-visually-hidden"> categories</span>
              {% endif %}
            </a>
          </dd>
        </div>
      </dl>

      {{ required_field("Model number", "product-model-number", "Optional") }}

      
      <h2 class="govuk-heading-m govuk-!-padding-top-6">
        Business
      </h2>

      {{ required_field("Name", "business-name", "Optional") }}
      {{ required_address_field("Registered address", "registered", "Optional") }}
      {{ required_address_field("Trading address", "trading", "Optional") }}
      {{ required_field("Contact name", "primary-contact-name", "Optional") }}
      {{ required_field("Email address", "email-address", "Optional") }}
      {{ required_field("Website", "website", "Optional") }}
      {{ required_field("Phone number", "phone-number", "Optional") }}

      <div class="govuk-!-margin-top-6">
        <a href="/delete-report">Delete incident report</a>
      </div>
    </div>
    <div class="govuk-grid-column-one-third">
      {% if data['do-you-have-a-report'] === 'yes' %}
        <form action="/confirmation-page" method="post">
          <input type="checkbox" name="confirmed" checked="true" class="govuk-visually-hidden"></input>
          <button class="govuk-button govuk-!-margin-top-6">
            Submit incident report
          </button>
        </form>
      {% else %}
        <p class="govuk-!-margin-top-6">
          To submit the report, attach a case file or answer all of the required questions.
        </p>
      {% endif %}
    </div>
  </div>

{% endblock %}

{% macro required_field(name, key, optional_with_file=true, required_text) %}
  <dl class="app-check-your-answers app-check-your-answers--short">
    <div class="app-check-your-answers__contents">
      <dt class="app-check-your-answers__question">
        {{ name }}
      </dt>
      <dd class="app-check-your-answers__answer">
        {% if data[key] %}
          {{ data[key] }}
        {% elif data['do-you-have-a-report'] === 'yes' and optional_with_file %}
          <span class="hint-text">Optional</span>
        {% else %}
          <span class="hint-text">{{ required_text }}</span>
        {% endif %}
      </dd>
      <dd class="app-check-your-answers__change">
        <a href="{{key}}">
          {% if data[key] %}
            Change<span class="govuk-visually-hidden"> {{ name }}</span>
          {% else %}
            Add<span class="govuk-visually-hidden"> {{ name }}</span>
          {% endif %}
        </a>
      </dd>
    </div>
  </dl>
{% endmacro %}

{% macro required_address_field(name, key, required_text) %}
  <dl class="app-check-your-answers app-check-your-answers--short">
    <div class="app-check-your-answers__contents">
      <dt class="app-check-your-answers__question">
        {{ name }}
      </dt>
      <dd class="app-check-your-answers__answer">
        {% if data[key + "-address-line-1"] %}
          <p>
            {{ data[key + "-address-line-1"] }}<br />
            {{ data[key + "-address-line-2"] }}<br />
            {{ data[key + "-address-town"] }}<br />
            {{ data[key + "-address-county"] }}<br />
            {{ data[key + "-address-postcode"] }}
          </p>
        {% elif data['do-you-have-a-report'] === 'yes' %}
          <span class="hint-text">Optional</span>
        {% else %}
          <span class="hint-text">{{ required_text }}</span>
        {% endif %}
      </dd>
      <dd class="app-check-your-answers__change">
        <a href="{{key}}-address">
          {% if data[key + "-address-line-1"] %}
            Change<span class="govuk-visually-hidden"> {{ name }}</span>
          {% else %}
            Add<span class="govuk-visually-hidden"> {{ name }}</span>
          {% endif %}
        </a>
      </dd>
    </div>
  </dl>
{% endmacro %}